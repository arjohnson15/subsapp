<h2 style="color: #4fc3f7; margin-bottom: 30px;">System Settings</h2>

<!-- Application Branding -->
<div class="settings-section">
    <h3>Application Branding</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Customize the appearance and branding of your application.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="appTitle">Application Title:</label>
            <input type="text" id="appTitle" placeholder="e.g. JOHNSONFLIX">
            <small style="color: #4fc3f7;">The main title displayed at the top of the page</small>
        </div>
        <div class="form-group">
            <label for="appSubtitle">Application Subtitle:</label>
            <input type="text" id="appSubtitle" placeholder="e.g. Subscription Management System">
            <small style="color: #4fc3f7;">The subtitle text below the main title</small>
        </div>
        
        <!-- Logo Upload Section -->
        <div class="form-group">
            <label>Logo:</label>
            <div class="file-upload-section">
                <div class="current-file-display" id="logoPreview" style="display: none;">
                    <img id="logoImage" src="" alt="Current Logo" style="max-height: 60px; max-width: 200px; object-fit: contain; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <button type="button" class="btn btn-delete" onclick="Settings.deleteBrandingFile('logo')" style="margin-left: 10px;">Delete Logo</button>
                </div>
                <div class="file-upload-controls">
                    <input type="file" id="logoFile" accept="image/*" style="display: none;" onchange="Settings.previewFile('logo')">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('logoFile').click()">
                        <span id="logoButtonText">Choose Logo Image</span>
                    </button>
                    <small style="color: #4fc3f7; display: block; margin-top: 5px;">Upload an image file (PNG, JPG, GIF, SVG). Replaces text title when set.</small>
                </div>
            </div>
        </div>
        
        <!-- Favicon Upload Section -->
        <div class="form-group">
            <label>Favicon:</label>
            <div class="file-upload-section">
                <div class="current-file-display" id="faviconPreview" style="display: none;">
                    <img id="faviconImage" src="" alt="Current Favicon" style="max-height: 32px; max-width: 32px; object-fit: contain; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <span id="faviconFileName" style="margin-left: 10px; color: #4fc3f7;"></span>
                    <button type="button" class="btn btn-delete" onclick="Settings.deleteBrandingFile('favicon')" style="margin-left: 10px;">Delete Favicon</button>
                </div>
                <div class="file-upload-controls">
                    <input type="file" id="faviconFile" accept="image/*,.ico" style="display: none;" onchange="Settings.previewFile('favicon')">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('faviconFile').click()">
                        <span id="faviconButtonText">Choose Favicon</span>
                    </button>
                    <small style="color: #4fc3f7; display: block; margin-top: 5px;">Upload favicon file (ICO, PNG, JPG). Shows in browser tab.</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Configuration -->
<div class="settings-section">
    <h3>Email Configuration</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure SMTP settings for sending emails. Use Gmail App Password, not your regular password.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="smtpHost">SMTP Host:</label>
            <input type="text" id="smtpHost" placeholder="smtp.gmail.com">
        </div>
        <div class="form-group">
            <label for="smtpPort">SMTP Port:</label>
            <input type="number" id="smtpPort" placeholder="587">
        </div>
        <div class="form-group">
            <label for="smtpUser">Email Address:</label>
            <input type="email" id="smtpUser" placeholder="your-email@gmail.com">
        </div>
        <div class="form-group">
            <label for="smtpPass">Gmail App Password:</label>
            <input type="password" id="smtpPass" placeholder="Your Gmail App Password">
            <small style="color: #4fc3f7;">Generate an App Password in your Google Account settings</small>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-test" onclick="Settings.sendTestEmail()">Send Test Email</button>
        <small style="color: #4fc3f7; margin-left: 15px;">Send a test email to verify configuration</small>
    </div>
</div>

<!-- Plex Configuration -->
<div class="settings-section">
    <h3>Plex Configuration</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Test connections and sync library information from Plex servers.</p>
    
    <div class="form-grid">
<div class="form-group">
    <label>Plex 1 Status:</label>
    <div style="display: flex; align-items: center; gap: 10px;">
        <span id="plex1Status" class="connection-status"></span>
        <button class="btn btn-test" onclick="testPlexConnection('plex1')">Test Connection</button>
    </div>
</div>
<div class="form-group">
    <label>Plex 2 Status:</label>
    <div style="display: flex; align-items: center; gap: 10px;">
        <span id="plex2Status" class="connection-status"></span>
        <button class="btn btn-test" onclick="testPlexConnection('plex2')">Test Connection</button>
    </div>
</div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-sync" onclick="syncAllPlexLibraries()">Sync All Libraries</button>
        <small style="color: #4fc3f7; margin-left: 15px;">
            Last sync: <span id="lastSyncTime">Never</span>
        </small>
    </div>
</div>

<!-- Payment & Links -->
<div class="settings-section">
    <h3>Payment & Links</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure payment links for renewal emails.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="paypalLink">PayPal Link:</label>
            <input type="url" id="paypalLink" placeholder="https://paypal.me/yourusername">
        </div>
        <div class="form-group">
            <label for="venmoLink">Venmo Link:</label>
            <input type="url" id="venmoLink" placeholder="https://venmo.com/yourusername">
        </div>
        <div class="form-group">
            <label for="cashappLink">CashApp Link:</label>
            <input type="url" id="cashappLink" placeholder="https://cash.app/$yourusername">
        </div>
    </div>
</div>

<!-- Owner Management Section -->
<div class="settings-section">
    <h3>Owner Management</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Manage owners who receive BCC notifications for user renewals and updates.</p>
    
    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="Settings.showOwnerForm()">Add New Owner</button>
    </div>
    
    <!-- Owner Form (hidden by default) -->
    <div id="ownerFormContainer" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; border-radius: 8px;">
        <h4 id="ownerFormTitle" style="color: #4fc3f7; margin-bottom: 20px;">Add New Owner</h4>
        <form id="ownerForm" onsubmit="Settings.saveOwner(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="ownerName">Owner Name:</label>
                    <input type="text" id="ownerName" name="name" required placeholder="e.g., John Johnson">
                </div>
                <div class="form-group">
                    <label for="ownerEmail">Owner Email:</label>
                    <input type="email" id="ownerEmail" name="email" required placeholder="owner@example.com">
                </div>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="ownerActive" name="active" checked style="margin-right: 8px;">
                    Active (receives notifications)
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn">Save Owner</button>
                <button type="button" class="btn btn-secondary" onclick="Settings.hideOwnerForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Owners Table -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="ownersTableBody">
                <tr><td colspan="5" style="text-align: center;">Loading owners...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Subscription Management Section -->
<div class="settings-section">
    <h3>Subscription Management</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Manage subscription types available for users. Create Plex and IPTV subscription plans.</p>
    
    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="Settings.showSubscriptionForm()">Add New Subscription Type</button>
    </div>
    
    <!-- Subscription Form (hidden by default) -->
    <div id="subscriptionFormContainer" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; border-radius: 8px;">
        <h4 id="subscriptionFormTitle" style="color: #4fc3f7; margin-bottom: 20px;">Create Subscription Type</h4>
        <form id="subscriptionForm" onsubmit="Settings.saveSubscription(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="subscriptionName">Subscription Name:</label>
                    <input type="text" id="subscriptionName" name="name" required placeholder="e.g., Plex Premium">
                </div>
                <div class="form-group">
                    <label for="subscriptionType">Type:</label>
                    <select id="subscriptionType" name="type" required onchange="Settings.handleSubscriptionTypeChange()">
                        <option value="">Select Type</option>
                        <option value="plex">Plex</option>
                        <option value="iptv">IPTV</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subscriptionDuration">Duration (Months):</label>
                    <input type="number" id="subscriptionDuration" name="duration_months" required min="1" max="120" placeholder="e.g., 12">
                </div>
                <div class="form-group">
                    <label for="subscriptionPrice">Price ($):</label>
                    <input type="number" id="subscriptionPrice" name="price" required min="0" step="0.01" placeholder="e.g., 120.00">
                </div>
            </div>
            
            <div class="form-group" id="streamCountGroup" style="display: none;">
                <label for="subscriptionStreams">Number of Streams:</label>
                <input type="number" id="subscriptionStreams" name="streams" min="1" max="10" placeholder="e.g., 2">
                <small style="color: #4fc3f7;">Leave blank if not applicable</small>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="subscriptionActive" name="active" checked style="margin-right: 8px;">
                    Active (available for new users)
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn">Save Subscription</button>
                <button type="button" class="btn btn-secondary" onclick="Settings.hideSubscriptionForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Subscriptions Table -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th style="cursor: pointer;" onclick="Settings.sortSubscriptions('name')">Name</th>
                    <th style="cursor: pointer;" onclick="Settings.sortSubscriptions('type')">Type</th>
                    <th style="cursor: pointer;" onclick="Settings.sortSubscriptions('duration_months')">Duration</th>
                    <th>Streams</th>
                    <th style="cursor: pointer;" onclick="Settings.sortSubscriptions('price')">Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="subscriptionsTableBody">
                <tr><td colspan="7" style="text-align: center;">Loading subscription types...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Save Button -->
<div style="margin-top: 40px; text-align: center;">
    <button class="btn btn-primary" onclick="Settings.saveAllSettings()" style="padding: 15px 40px; font-size: 16px;">
        Save All Settings
    </button>
</div>

<style>
.settings-section {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid #4caf50;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
}

.settings-section h3 {
    color: #4caf50;
    margin-bottom: 15px;
    font-size: 1.4em;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    color: #fff;
    font-weight: 500;
    margin-bottom: 8px;
}

.form-group input, .form-group select {
    padding: 10px;
    border: 1px solid #4fc3f7;
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    font-size: 14px;
}

.form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #4caf50;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
}

.form-group small {
    margin-top: 5px;
    font-size: 12px;
}

.file-upload-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.current-file-display {
    display: flex;
    align-items: center;
    padding: 10px;
    background: rgba(79, 195, 247, 0.1);
    border: 1px solid #4fc3f7;
    border-radius: 4px;
}

.file-upload-controls {
    display: flex;
    flex-direction: column;
}

.connection-status {
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    min-width: 80px;
    text-align: center;
}

.status-connected {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    border: 1px solid #4caf50;
}

.status-disconnected {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
    border: 1px solid #f44336;
}

.status-testing {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    border: 1px solid #ffc107;
}

.table-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #4fc3f7;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th {
    background: rgba(79, 195, 247, 0.2);
    color: #4fc3f7;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #4fc3f7;
}

.data-table td {
    padding: 12px;
    border-bottom: 1px solid rgba(79, 195, 247, 0.1);
    color: #fff;
}

.data-table tr:hover {
    background: rgba(79, 195, 247, 0.05);
}

.tag {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.tag-plex {
    background: rgba(229, 160, 13, 0.2);
    color: #e5a00d;
}

.tag-iptv {
    background: rgba(103, 58, 183, 0.2);
    color: #673ab7;
}

.tag-plex1 {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.tag-free {
    background: rgba(158, 158, 158, 0.2);
    color: #9e9e9e;
}

.btn-test {
    background: linear-gradient(135deg, #ffc107, #ff9800);
    color: #000;
}

.btn-sync {
    background: linear-gradient(135deg, #2196f3, #00bcd4);
    color: #fff;
}

.btn-small {
    padding: 4px 8px;
    font-size: 12px;
    margin: 0 2px;
}

.btn-edit {
    background: linear-gradient(135deg, #4fc3f7, #29b6f6);
    color: #fff;
}

.btn-delete {
    background: linear-gradient(135deg, #f44336, #e91e63);
    color: #fff;
}
</style>