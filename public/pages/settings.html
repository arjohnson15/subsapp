<h2 style="color: #4fc3f7; margin-bottom: 30px;">System Settings</h2>

<!-- Application Branding -->
<div class="settings-section">
    <h3>Application Branding</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Customize the appearance and branding of your application.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="appTitle">Application Title:</label>
            <input type="text" id="appTitle" placeholder="e.g. JOHNSONFLIX">
            <small style="color: #4fc3f7;">The main title displayed at the top of the page</small>
        </div>
        <div class="form-group">
            <label for="appSubtitle">Application Subtitle:</label>
            <input type="text" id="appSubtitle" placeholder="e.g. Subscription Management System">
            <small style="color: #4fc3f7;">The subtitle text below the main title</small>
        </div>
        
        <!-- Logo Upload Section -->
        <div class="form-group">
            <label>Logo:</label>
            <div class="file-upload-section">
                <div class="current-file-display" id="logoPreview" style="display: none;">
                    <img id="logoImage" src="" alt="Current Logo" style="max-height: 60px; max-width: 200px; object-fit: contain; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <button type="button" class="btn btn-delete" onclick="Settings.deleteBrandingFile('logo')" style="margin-left: 10px;">Delete Logo</button>
                </div>
                <div class="file-upload-controls">
                    <input type="file" id="logoFile" accept="image/*" style="display: none;" onchange="Settings.previewFile('logo')">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('logoFile').click()">
                        <span id="logoButtonText">Choose Logo Image</span>
                    </button>
                    <small style="color: #4fc3f7; display: block; margin-top: 5px;">Upload an image file (PNG, JPG, GIF, SVG). Replaces text title when set.</small>
                </div>
            </div>
        </div>
        
        <!-- Favicon Upload Section -->
        <div class="form-group">
            <label>Favicon:</label>
            <div class="file-upload-section">
                <div class="current-file-display" id="faviconPreview" style="display: none;">
                    <img id="faviconImage" src="" alt="Current Favicon" style="max-height: 32px; max-width: 32px; object-fit: contain; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <span id="faviconFileName" style="margin-left: 10px; color: #4fc3f7;"></span>
                    <button type="button" class="btn btn-delete" onclick="Settings.deleteBrandingFile('favicon')" style="margin-left: 10px;">Delete Favicon</button>
                </div>
                <div class="file-upload-controls">
                    <input type="file" id="faviconFile" accept="image/*,.ico" style="display: none;" onchange="Settings.previewFile('favicon')">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('faviconFile').click()">
                        <span id="faviconButtonText">Choose Favicon</span>
                    </button>
                    <small style="color: #4fc3f7; display: block; margin-top: 5px;">Upload favicon file (ICO, PNG, JPG). Shows in browser tab.</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Configuration -->
<div class="settings-section">
    <h3>Email Configuration</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure SMTP settings for sending emails. Use Gmail App Password, not your regular password.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="smtpHost">SMTP Host:</label>
            <input type="text" id="smtpHost" placeholder="smtp.gmail.com">
        </div>
        <div class="form-group">
            <label for="smtpPort">SMTP Port:</label>
            <input type="number" id="smtpPort" placeholder="587">
        </div>
        <div class="form-group">
            <label for="smtpUser">Email Address:</label>
            <input type="email" id="smtpUser" placeholder="your-email@gmail.com">
        </div>
        <div class="form-group">
            <label for="smtpPass">Gmail App Password:</label>
            <input type="password" id="smtpPass" placeholder="Your Gmail App Password">
            <small style="color: #4fc3f7;">Generate an App Password in your Google Account settings</small>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-test" onclick="Settings.sendTestEmail()">Send Test Email</button>
        <small style="color: #4fc3f7; margin-left: 15px;">Send a test email to verify configuration</small>
    </div>
</div>

<!-- IPTV Panel Configuration Section -->
<div class="settings-section">
    <h3>IPTV Panel Configuration</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure IPTV panel integration for subscription management.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="iptvPanelBaseUrl">Panel Base URL:</label>
            <input type="text" id="iptvPanelBaseUrl" name="iptv_panel_base_url" placeholder="https://panel.pinkpony.lol" value="">
            <small style="color: #4fc3f7;">Base URL for the IPTV panel API (without /login or trailing slash)</small>
        </div>
        
        <div class="form-group">
            <label for="iptvPanelLoginUrl">Login URL:</label>
            <input type="text" id="iptvPanelLoginUrl" name="iptv_panel_login_url" placeholder="https://panel.pinkpony.lol/login/rwykjyh" value="">
            <small style="color: #4fc3f7;">Full login URL including any unique path</small>
        </div>
        
        <div class="form-group">
            <label for="iptvPanelUsername">Panel Username:</label>
            <input type="text" id="iptvPanelUsername" name="iptv_panel_username" placeholder="your-username" value="">
        </div>
        
        <div class="form-group">
            <label for="iptvPanelPassword">Panel Password:</label>
            <input type="password" id="iptvPanelPassword" name="iptv_panel_password" placeholder="your-password" value="">
        </div>
        
        <div class="form-group">
            <label for="iptvPackageIdForBouquets">Package ID for Bouquets:</label>
            <input type="text" id="iptvPackageIdForBouquets" name="iptv_package_id_for_bouquets" placeholder="175" value="">
            <small style="color: #4fc3f7;">Package ID to use when fetching available bouquets</small>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-test" onclick="SettingsIPTV.testPanelConnection()">Test Connection</button>
        <small style="color: #4fc3f7; margin-left: 15px;">Verify panel credentials and connection</small>
    </div>
    
    <!-- Connection Status Display -->
    <div style="margin-top: 15px;">
        <div style="background: rgba(0, 0, 0, 0.3); padding: 10px 15px; border-radius: 6px; border: 1px solid #333;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span id="connectionStatusText" style="color: #fff;">Ready to test connection...</span>
                <span id="connectionStatusIcon" style="font-size: 1.2rem;">⚪</span>
            </div>
        </div>
    </div>
    
    <!-- IPTV Statistics Grid -->
    <div style="margin-top: 25px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <!-- Available Credits -->
            <div style="background: rgba(76, 175, 80, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #4caf50; text-align: center;">
                <div style="color: #4caf50; font-size: 1.8rem; font-weight: bold;" id="currentCreditBalance">-</div>
                <div style="color: #4caf50; font-weight: 500; margin: 5px 0;">Available Credits</div>
                <div style="display: flex; justify-content: center; gap: 5px; align-items: center; margin-top: 8px;">
                    <button type="button" class="btn btn-sm" onclick="SettingsIPTV.syncCreditsBalance()" style="background: linear-gradient(45deg, #4caf50, #8bc34a); font-size: 0.8rem; padding: 4px 8px;">
                        Sync
                    </button>
                </div>
                <div id="lastCreditSync" style="color: #81c784; font-size: 0.75rem; margin-top: 5px;">Never synced</div>
            </div>
            
            <!-- Total Packages -->
            <div style="background: rgba(33, 150, 243, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #2196f3; text-align: center;">
                <div style="color: #2196f3; font-size: 1.8rem; font-weight: bold;" id="totalPackagesCount">-</div>
                <div style="color: #2196f3; font-weight: 500; margin: 5px 0;">Total Packages</div>
                <div style="display: flex; justify-content: center; gap: 5px; align-items: center; margin-top: 8px;">
                    <button type="button" class="btn btn-sm" onclick="SettingsIPTV.syncPackagesFromPanel()" style="background: linear-gradient(45deg, #2196f3, #64b5f6); font-size: 0.8rem; padding: 4px 8px;">
                        Sync
                    </button>
                </div>
                <div id="lastPackageSync" style="color: #64b5f6; font-size: 0.75rem; margin-top: 5px;">Never synced</div>
            </div>
            
            <!-- Total Bouquets -->
            <div style="background: rgba(156, 39, 176, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #9c27b0; text-align: center;">
                <div style="color: #9c27b0; font-size: 1.8rem; font-weight: bold;" id="totalBouquetsCount">-</div>
                <div style="color: #9c27b0; font-weight: 500; margin: 5px 0;">Total Bouquets</div>
                <div style="display: flex; justify-content: center; gap: 5px; align-items: center; margin-top: 8px;">
                    <button type="button" class="btn btn-sm" onclick="SettingsIPTV.syncBouquetsFromPanel()" style="background: linear-gradient(45deg, #9c27b0, #ba68c8); font-size: 0.8rem; padding: 4px 8px;">
                        Sync
                    </button>
                </div>
                <div id="lastBouquetSync" style="color: #ba68c8; font-size: 0.75rem; margin-top: 5px;">Never synced</div>
            </div>
        </div>
    </div>
</div>

<!-- IPTV Channel Groups Management Section -->
<div class="settings-section">
    <h3>IPTV Channel Groups</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Create custom channel groups by combining bouquets for easy user assignment.</p>
    
    <!-- Add New Channel Group Form -->
    <div id="channelGroupForm" style="display: none; background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px;">
        <h4 style="color: #4fc3f7; margin-bottom: 15px;" id="channelGroupFormTitle">Create New Channel Group</h4>
        <form onsubmit="Settings.saveChannelGroup(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="channelGroupName">Group Name:</label>
                    <input type="text" id="channelGroupName" required>
                </div>
                <div class="form-group">
                    <label for="channelGroupDescription">Description:</label>
                    <input type="text" id="channelGroupDescription">
                </div>
            </div>
            
            <div class="form-group">
                <label>Select Bouquets:</label>
                <div id="bouquetSelector" style="background: rgba(0,0,0,0.5); border: 1px solid #333; border-radius: 4px; padding: 10px; max-height: 300px; overflow-y: auto;">
                    <p style="color: #666; text-align: center;">Loading bouquets...</p>
                </div>
            </div>
            
            <div style="text-align: right; margin-top: 15px;">
                <button type="button" class="btn btn-secondary" onclick="Settings.hideChannelGroupForm()">Cancel</button>
                <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Save Channel Group</button>
            </div>
        </form>
    </div>
    
    <!-- Channel Groups Table Controls -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button class="btn" onclick="Settings.showChannelGroupForm()" style="background: linear-gradient(45deg, #4caf50, #8bc34a);">
                <i class="fas fa-plus"></i> Create New Channel Group
            </button>
            <button type="button" class="btn" onclick="Settings.viewBouquetDetails()" style="background: linear-gradient(45deg, #9c27b0, #e91e63); font-size: 0.9rem; padding: 8px 16px;">
                <i class="fas fa-list"></i> View All Bouquets
            </button>
        </div>
        <button type="button" class="btn" onclick="Settings.loadChannelGroups()" style="padding: 8px 16px; font-size: 0.9rem;">
            <i class="fas fa-sync"></i> Refresh List
        </button>
    </div>
    
    <!-- Channel Groups Table -->
    <div class="table-container">
        <table class="data-table channel-groups-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Bouquets</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="channelGroupsTableBody">
                <tr><td colspan="6" style="text-align: center; color: #666;">Loading channel groups...</td></tr>
            </tbody>
        </table>
    </div>
    
    <!-- Default Groups Settings -->
    <div style="margin-top: 25px; padding: 15px; background: rgba(76, 175, 80, 0.1); border: 1px solid #4caf50; border-radius: 8px;">
        <h4 style="color: #4caf50; margin-bottom: 15px;">Default Group Settings</h4>
        <p style="color: #4fc3f7; margin-bottom: 15px; font-size: 0.9rem;">
            <i class="fas fa-lightbulb" style="color: #ffc107;"></i> Set default channel groups for automatic assignment to new trial and paid users.
        </p>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div>
                <label style="color: #fff; display: block; margin-bottom: 5px;">Default Trial Group:</label>
                <select id="defaultTrialGroup" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.7); color: #fff; border: 1px solid #4caf50; border-radius: 4px;">
                    <option value="">None selected</option>
                </select>
            </div>
            <div>
                <label style="color: #fff; display: block; margin-bottom: 5px;">Default Paid Group:</label>
                <select id="defaultPaidGroup" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.7); color: #fff; border: 1px solid #4caf50; border-radius: 4px;">
                    <option value="">None selected</option>
                </select>
            </div>
        </div>
        <div style="text-align: center; margin-top: 15px;">
            <button type="button" class="btn" onclick="Settings.saveDefaultGroups()" style="background: linear-gradient(45deg, #4caf50, #8bc34a);">
                <i class="fas fa-save"></i> Save Default Settings
            </button>
        </div>
    </div>
</div>

<!-- IPTV Editor Integration Section - ADD TO EXISTING settings.html -->
<div class="settings-section">
    <h3>IPTV Editor Integration</h3>
    
    <!-- Status Display -->
    <div class="integration-status">
        <div class="status-item">
            <span>Connection:</span>
            <span id="iptvEditorConnectionStatus" class="status-missing">NOT TESTED</span>
        </div>
        <div class="status-item">
            <span>Bearer Token:</span>
            <span id="iptvEditorTokenStatus" class="status-missing">MISSING</span>
        </div>
        <div class="status-item">
            <span>Default Playlist:</span>
            <span id="iptvEditorPlaylistStatus" class="status-missing">NOT SELECTED</span>
        </div>
        <div class="status-item">
            <span>API Endpoint:</span>
            <span class="status-configured">https://editor.iptveditor.com/api</span>
        </div>
    </div>
    
    <!-- Configuration Form -->
    <div class="form-group">
        <label for="iptvBearerToken">Bearer Token *</label>
        <input type="password" id="iptvBearerToken" placeholder="Enter your IPTV Editor bearer token">
        <small style="color: #4fc3f7;">Required for API authentication (get from IPTV Editor login - expires monthly)</small>
    </div>
    
    <div class="form-group">
        <label for="iptvPlaylistSelect">Default Playlist</label>
        <div class="input-with-button">
            <select id="iptvPlaylistSelect">
                <option value="">Select a playlist...</option>
            </select>
            <button type="button" onclick="syncIPTVEditorPlaylists()" class="btn btn-secondary">Load Playlists</button>
        </div>
        <small style="color: #4fc3f7;">This playlist will be used for all new user accounts</small>
    </div>
    
    <div class="form-group">
        <label>
            <input type="checkbox" id="iptvEditorSyncEnabled" style="margin-right: 8px;">
            Enable Automatic Sync
        </label>
        <small style="color: #4fc3f7;">Automatically sync user accounts with IPTV Editor</small>
    </div>
    
    <!-- Action Buttons -->
    <div class="form-actions">
        <button type="button" onclick="testIPTVEditorConnection()" class="btn btn-test">
            <i class="fas fa-wifi"></i> Test Connection
        </button>
        <button type="button" onclick="saveIPTVEditorSettings()" class="btn">
            <i class="fas fa-save"></i> Save IPTV Editor Settings
        </button>
        <button type="button" onclick="loadIPTVEditorLogs()" class="btn btn-secondary">
            <i class="fas fa-list"></i> View Sync Logs
        </button>
    </div>
    
    <!-- User Management Section -->
    <div style="margin-top: 30px;">
        <h4 style="color: #4fc3f7; margin-bottom: 15px;">IPTV Editor User Management</h4>
        <p style="color: #4fc3f7; margin-bottom: 20px; font-size: 0.9rem;">
            Manage users who have IPTV Editor accounts and sync their data.
        </p>
        
        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <button type="button" onclick="manualIPTVEditorSync()" class="btn" style="background: linear-gradient(45deg, #4caf50, #8bc34a);">
                <i class="fas fa-sync"></i> Manual Sync All
            </button>
            <button type="button" onclick="createIPTVEditorUser()" class="btn" style="background: linear-gradient(45deg, #2196f3, #03a9f4);">
                <i class="fas fa-user-plus"></i> Create User
            </button>
            <button type="button" onclick="bulkCreateIPTVEditorUsers()" class="btn" style="background: linear-gradient(45deg, #ff9800, #ffc107);">
                <i class="fas fa-users"></i> Bulk Create
            </button>
        </div>
        
        <!-- Users Table -->
        <div class="table-container">
            <table id="iptv-editor-users-table" class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>IPTV Username</th>
                        <th>Max Connections</th>
                        <th>Expiry Date</th>
                        <th>Sync Status</th>
                        <th>Last Sync</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="8" style="text-align: center;">Loading IPTV Editor users...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Sync Logs Section -->
    <div id="iptvEditorLogsSection" style="margin-top: 30px; display: none;">
        <h4 style="color: #4fc3f7; margin-bottom: 15px;">Recent Sync Logs</h4>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div style="display: flex; gap: 10px;">
                <select id="logTypeFilter" style="padding: 8px; background: rgba(0,0,0,0.7); color: #fff; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <option value="">All Types</option>
                    <option value="user_create">User Create</option>
                    <option value="user_delete">User Delete</option>
                    <option value="user_sync">User Sync</option>
                    <option value="playlist_sync">Playlist Sync</option>
                </select>
                <select id="logStatusFilter" style="padding: 8px; background: rgba(0,0,0,0.7); color: #fff; border: 1px solid #4fc3f7; border-radius: 4px;">
                    <option value="">All Status</option>
                    <option value="success">Success</option>
                    <option value="error">Error</option>
                </select>
                <button type="button" onclick="loadIPTVEditorLogs()" class="btn btn-sm">
                    <i class="fas fa-filter"></i> Filter
                </button>
            </div>
            <button type="button" onclick="clearOldIPTVEditorLogs()" class="btn btn-sm" style="background: #f44336;">
                <i class="fas fa-trash"></i> Clear Old Logs
            </button>
        </div>
        
        <div class="table-container">
            <table id="iptv-editor-logs-table" class="data-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Type</th>
                        <th>User</th>
                        <th>Status</th>
                        <th>Duration</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="6" style="text-align: center;">Loading sync logs...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Plex Configuration -->
<div class="settings-section">
    <h3>Plex Configuration</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Test connections and sync library information from Plex servers.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label>Plex 1 Status:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="plex1Status" class="connection-status"></span>
                <button class="btn btn-test" onclick="testPlexConnection('plex1')">Test Connection</button>
            </div>
        </div>
        <div class="form-group">
            <label>Plex 2 Status:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span id="plex2Status" class="connection-status"></span>
                <button class="btn btn-test" onclick="testPlexConnection('plex2')">Test Connection</button>
            </div>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <button class="btn btn-sync" onclick="syncAllPlexLibraries()">Sync All Libraries</button>
        <small style="color: #4fc3f7; margin-left: 15px;">
            Last sync: <span id="lastSyncTime">Never</span>
        </small>
    </div>
</div>

<!-- Payment & Links -->
<div class="settings-section">
    <h3>Payment & Links</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure payment links for renewal emails.</p>
    
    <div class="form-grid">
        <div class="form-group">
            <label for="paypalLink">PayPal Link:</label>
            <input type="url" id="paypalLink" placeholder="https://paypal.me/yourusername">
        </div>
        <div class="form-group">
            <label for="venmoLink">Venmo Link:</label>
            <input type="url" id="venmoLink" placeholder="https://venmo.com/yourusername">
        </div>
        <div class="form-group">
            <label for="cashappLink">CashApp Link:</label>
            <input type="url" id="cashappLink" placeholder="https://cash.app/$yourusername">
        </div>
    </div>
</div>

<!-- Owner Management Section -->
<div class="settings-section">
    <h3>Owner Management</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Manage owners who receive BCC notifications for user renewals and updates.</p>
    
    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="Settings.showOwnerForm()">Add New Owner</button>
    </div>
    
    <!-- Owner Form (hidden by default) -->
    <div id="ownerFormContainer" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; border-radius: 8px;">
        <h4 id="ownerFormTitle" style="color: #4fc3f7; margin-bottom: 20px;">Add New Owner</h4>
        <form id="ownerForm" onsubmit="Settings.saveOwner(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="ownerName">Owner Name:</label>
                    <input type="text" id="ownerName" name="name" required placeholder="e.g., John Johnson">
                </div>
                <div class="form-group">
                    <label for="ownerEmail">Owner Email:</label>
                    <input type="email" id="ownerEmail" name="email" required placeholder="owner@example.com">
                </div>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="ownerActive" name="active" checked style="margin-right: 8px;">
                    Active (receives notifications)
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn">Save Owner</button>
                <button type="button" class="btn btn-secondary" onclick="Settings.hideOwnerForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Owners Table -->
    <div class="table-container">
        <table class="data-table owners-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="ownersTableBody">
                <tr><td colspan="5" style="text-align: center;">Loading owners...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Subscription Management Section - FIXED HEADERS -->
<div class="settings-section">
    <h3>Subscription Management</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Manage subscription types available for users. Create Plex and IPTV subscription plans.</p>
    
    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="Settings.showSubscriptionForm()">Add New Subscription Type</button>
    </div>
    
    <!-- Subscription Form (hidden by default) -->
    <div id="subscriptionFormContainer" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; border-radius: 8px;">
        <h4 id="subscriptionFormTitle" style="color: #4fc3f7; margin-bottom: 20px;">Create Subscription Type</h4>
        <form id="subscriptionForm" onsubmit="Settings.saveSubscription(event)">
            <div class="form-grid">
                <div class="form-group">
                    <label for="subscriptionName">Subscription Name:</label>
                    <input type="text" id="subscriptionName" name="name" required placeholder="e.g., Plex Premium">
                </div>
                <div class="form-group">
                    <label for="subscriptionType">Type:</label>
                    <select id="subscriptionType" name="type" required onchange="Settings.handleSubscriptionTypeChange()">
                        <option value="">Select Type</option>
                        <option value="plex">Plex</option>
                        <option value="iptv">IPTV</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subscriptionDuration">Duration (Months):</label>
                    <input type="number" id="subscriptionDuration" name="duration_months" required min="1" max="120" placeholder="e.g., 12">
                </div>
                <div class="form-group">
                    <label for="subscriptionPrice">Price ($):</label>
                    <input type="number" id="subscriptionPrice" name="price" required min="0" step="0.01" placeholder="e.g., 120.00">
                </div>
            </div>
            
            <div class="form-group" id="streamCountGroup" style="display: none;">
                <label for="subscriptionStreams">Number of Streams:</label>
                <input type="number" id="subscriptionStreams" name="streams" min="1" max="10" placeholder="e.g., 2">
                <small style="color: #4fc3f7;">Leave blank if not applicable</small>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="subscriptionActive" name="active" checked style="margin-right: 8px;">
                    Active (available for new users)
                </label>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn">Save Subscription</button>
                <button type="button" class="btn btn-secondary" onclick="Settings.hideSubscriptionForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Subscriptions Table - FIXED: Removed clickable headers -->
    <div class="table-container">
        <table class="data-table subscriptions-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Duration</th>
                    <th>Streams</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="subscriptionsTableBody">
                <tr><td colspan="7" style="text-align: center;">Loading subscription types...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Email Automation Scheduler Section -->
<div class="settings-section">
    <h3>Email Automation Scheduler</h3>
    <p style="color: #4fc3f7; margin-bottom: 20px;">Configure automated email schedules for renewals and custom mailings.</p>
    
    <div style="margin-bottom: 20px;">
        <button class="btn" onclick="Settings.showScheduleForm()">Add New Schedule</button>
    </div>

    <!-- Schedule Form (hidden by default) -->
    <div id="scheduleFormContainer" style="display: none; margin-bottom: 30px; padding: 20px; background: rgba(79, 195, 247, 0.1); border: 1px solid #4fc3f7; border-radius: 8px;">
        <h4 id="scheduleFormTitle" style="color: #4fc3f7; margin-bottom: 20px;">Add New Email Schedule</h4>
        <form id="scheduleForm" onsubmit="Settings.saveSchedule(event)">
            <input type="hidden" id="scheduleId" name="id">
            
            <div class="form-group">
                <label for="scheduleName">Schedule Name:</label>
                <input type="text" id="scheduleName" name="name" required placeholder="e.g., 7-Day Renewal Reminder">
            </div>

            <div class="form-group">
                <label for="scheduleType">Schedule Type:</label>
                <select id="scheduleType" name="schedule_type" required onchange="Settings.toggleScheduleFields()">
                    <option value="">Select Type</option>
                    <option value="expiration_reminder">Expiration Reminder</option>
                    <option value="specific_date">Specific Date/Time</option>
                </select>
            </div>

            <!-- Expiration Reminder Fields -->
            <div id="expirationFields" style="display: none;">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="daysBefore">Days Before Expiration:</label>
                        <input type="number" id="daysBefore" name="days_before_expiration" min="1" max="365" placeholder="7">
                    </div>
                    <div class="form-group">
                        <label for="subscriptionTypeFilter">Subscription Type:</label>
                        <select id="subscriptionTypeFilter" name="subscription_type">
                            <option value="both">Both Plex & IPTV</option>
                            <option value="plex">Plex Only</option>
                            <option value="iptv">IPTV Only</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Specific Date Fields -->
            <div id="specificDateFields" style="display: none; margin: 20px 0; padding: 20px; background: rgba(255, 193, 7, 0.1); border-left: 3px solid #ffc107; border-radius: 4px;">
                <h5 style="color: #f57c00; margin: 0 0 15px 0; font-size: 14px; font-weight: 600;">SPECIFIC DATE/TIME SETTINGS</h5>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="scheduledDate">Date:</label>
                        <input type="date" id="scheduledDate" name="scheduled_date" class="clean-date-input">
                    </div>
                    <div class="form-group">
                        <label for="scheduledTime">Time:</label>
                        <input type="time" id="scheduledTime" name="scheduled_time" class="clean-time-input">
                        <small style="color: #888; font-size: 0.85em; display: block; margin-top: 5px;">
                            ⏰ Enter time in Central Time (CT/CDT)
                        </small>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="emailTemplate">Email Template:</label>
                <select id="emailTemplate" name="email_template_id" required>
                    <option value="">Select Template</option>
                </select>
            </div>

            <div class="form-group">
                <label for="targetTags">Target User Tags (Optional):</label>
                <div id="targetTagsContainer" class="tags-container">
                    <!-- Dynamic tag checkboxes will be inserted here -->
                </div>
                <small>Leave blank to target all users matching other criteria</small>
            </div>

            <div style="margin: 25px 0; padding: 20px; background: rgba(79, 195, 247, 0.05); border-radius: 6px;">
                <div class="clean-checkbox-group" style="margin-bottom: 15px;">
                    <label class="clean-checkbox-label">
                        <input type="checkbox" id="excludeAutomated" name="exclude_users_with_setting" checked>
                        <span class="clean-checkbox-text">Exclude users who opted out of automated emails</span>
                    </label>
                </div>

                <div class="clean-checkbox-group">
                    <label class="clean-checkbox-label">
                        <input type="checkbox" id="scheduleActive" name="active" checked>
                        <span class="clean-checkbox-text">Active (schedule will run automatically)</span>
                    </label>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="submit" class="btn">Save Schedule</button>
                <button type="button" class="btn btn-secondary" onclick="Settings.hideScheduleForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Schedules Table -->
    <div class="table-container">
        <table class="data-table schedules-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Details</th>
                    <th>Template</th>
                    <th>Status</th>
                    <th>Last Run</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="schedulesTableBody">
                <tr><td colspan="7" style="text-align: center;">Loading schedules...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Save Button -->
<div style="margin-top: 40px; text-align: center;">
    <button class="btn btn-primary" onclick="Settings.saveAllSettings()" style="padding: 15px 40px; font-size: 16px;">
        Save All Settings
    </button>
</div>

<style>
.settings-section {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid #4caf50;
    border-radius: 8px;
    padding: 25px;
    margin-bottom: 30px;
}

.settings-section h3 {
    color: #4caf50;
    margin-bottom: 15px;
    font-size: 1.4em;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    color: #fff;
    font-weight: 500;
    margin-bottom: 8px;
}

.form-group input, .form-group select {
    padding: 10px;
    border: 1px solid #4fc3f7;
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    font-size: 14px;
}

.form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #4caf50;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
}

.form-group small {
    margin-top: 5px;
    font-size: 12px;
}

.file-upload-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.current-file-display {
    display: flex;
    align-items: center;
    padding: 10px;
    background: rgba(79, 195, 247, 0.1);
    border: 1px solid #4fc3f7;
    border-radius: 4px;
}

.file-upload-controls {
    display: flex;
    flex-direction: column;
}

.connection-status {
    padding: 5px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    min-width: 80px;
    text-align: center;
}

.status-connected {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    border: 1px solid #4caf50;
}

.status-disconnected {
    background: rgba(244, 67, 54, 0.2);
    color: #f44336;
    border: 1px solid #f44336;
}

.status-testing {
    background: rgba(255, 193, 7, 0.2);
    color: #ffc107;
    border: 1px solid #ffc107;
}

.table-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #4fc3f7;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th {
    background: rgba(79, 195, 247, 0.2);
    color: #4fc3f7;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #4fc3f7;
    /* REMOVED: cursor: pointer; - This was causing the sorting issue */
}

.data-table td {
    padding: 12px;
    border-bottom: 1px solid rgba(79, 195, 247, 0.1);
    color: #fff;
}

.data-table tr:hover {
    background: rgba(79, 195, 247, 0.05);
}

.tag {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.tag-plex {
    background: rgba(229, 160, 13, 0.2);
    color: #e5a00d;
}

.tag-iptv {
    background: rgba(103, 58, 183, 0.2);
    color: #673ab7;
}

.tag-plex1 {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
}

.tag-free {
    background: rgba(158, 158, 158, 0.2);
    color: #9e9e9e;
}

.btn-test {
    background: linear-gradient(135deg, #ffc107, #ff9800);
    color: #000;
}

.btn-sync {
    background: linear-gradient(135deg, #2196f3, #00bcd4);
    color: #fff;
}

.btn-small {
    padding: 4px 8px;
    font-size: 12px;
    margin: 0 2px;
}

.btn-edit {
    background: linear-gradient(135deg, #4fc3f7, #29b6f6);
    color: #fff;
}

.btn-delete {
    background: linear-gradient(135deg, #f44336, #e91e63);
    color: #fff;
}

/* Channel Groups Styling */
.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.status-active {
    background: rgba(76, 175, 80, 0.2);
    color: #4caf50;
    border: 1px solid #4caf50;
}

.status-inactive {
    background: rgba(158, 158, 158, 0.2);
    color: #9e9e9e;
    border: 1px solid #9e9e9e;
}

.status-info {
    background: rgba(33, 150, 243, 0.2);
    color: #2196f3;
    border: 1px solid #2196f3;
}

/* Ensure table styling matches other settings sections */
.channel-groups-table {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #4fc3f7;
}

.channel-groups-table th {
    background: rgba(79, 195, 247, 0.2);
    color: #4fc3f7;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #4fc3f7;
}

.channel-groups-table td {
    padding: 12px;
    border-bottom: 1px solid rgba(79, 195, 247, 0.1);
    color: #fff;
}

.channel-groups-table tr:hover {
    background: rgba(79, 195, 247, 0.05);
}
</style>